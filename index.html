<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Bubble Catcher</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        width: 100%;
        background: #000;
      }

      canvas {
        display: block;
        width: 100vw;
        height: 100vh;
        touch-action: none;
      }

      #restartBtn,
      #downloadBtn {
        font-size: bold 18px;
        padding: 10px 20px;
        display: none;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        background-color: #aee800;
        color: #000;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 20;
      }

      #restartBtn {
        top: 70%;
      }

      #downloadBtn {
        top: 80%;
      }

      #title {
        position: absolute;
        top: 10px;
        left: 10px;
        font-family: bold Arial, sans-serif;
        font-size: 20px;
        color: #aee800;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="title">Bubble Catcher</div>
    <canvas id="gameCanvas"></canvas>
    <button id="restartBtn" onclick="restartGame()">Restart</button>
    <button id="downloadBtn" onclick="downloadDummyFile()">Download & Share</button>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      const restartBtn = document.getElementById("restartBtn");
      const downloadBtn = document.getElementById("downloadBtn");

      const backgroundImage = new Image();
      backgroundImage.src = "https://subaquatic-legacy.github.io/bubblezzzz/images/Game_BG_1.png";
      backgroundImage.crossOrigin = "anonymous";

      const player = {
        x: 160,
        y: 550,
        width: 90,
        height: 90,
        speed: 7,
        image: new Image(),
      };
      player.image.src = "https://subaquatic-legacy.github.io/bubblezzzz/images/Game_Hero_yellow.png";
      player.image.crossOrigin = "anonymous";

      const whaleImg = new Image();
      whaleImg.crossOrigin = "anonymous";
      whaleImg.src = "https://subaquatic-legacy.github.io/bubblezzzz/images/Game_Lifes_Left_yellow.png";

      const bubbleImage = new Image();
      bubbleImage.src = "https://subaquatic-legacy.github.io/bubblezzzz/images/Game_Bubble.png";
      bubbleImage.crossOrigin = "anonymous";

      const redBubbleImage = new Image();
      redBubbleImage.src = "https://subaquatic-legacy.github.io/bubblezzzz/images/Game_Bubble_cyan.png";
      redBubbleImage.crossOrigin = "anonymous";

      let bubbles = [];
      let score = 0;
      let lives = 3;
      let gameOver = false;
      let bubbleInterval = 2000;
      let lastBubbleTime = 0;
      let lastDifficultyIncrease = Date.now();

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      function createBubble() {
        const margin = 20; // to avoid edges
        const x = margin + Math.random() * (canvas.width - 2 * margin);
        let isRed = Math.random() < 0.15;
        bubbles.push({
          x: x,
          y: 0,
          radius: 15 + Math.random() * 10,
          speed: isRed ? 1 : 1 + Math.random() * 1.5,
          opacity: 0.7 + Math.random() * 0.3,
          red: isRed,
        });
      }

      function update() {
        if (gameOver) return;

        let now = Date.now();
        if (now - lastBubbleTime > bubbleInterval) {
          createBubble();
          lastBubbleTime = now;
        }

        if (now - lastDifficultyIncrease > 10000 && bubbleInterval > 600) {
          bubbleInterval -= 200;
          lastDifficultyIncrease = now;
        }

        bubbles.forEach((bubble, index) => {
          bubble.y += bubble.speed;
          if (bubble.y > canvas.height) {
            bubbles.splice(index, 1);
            lives--;
            if (lives <= 0) {
              gameOver = true;
              restartBtn.style.display = "inline-block";
              downloadBtn.style.display = "inline-block";
            }
          }
        });

        bubbles = bubbles.filter((bubble) => {
          const hit =
            bubble.x > player.x &&
            bubble.x < player.x + player.width &&
            bubble.y + bubble.radius > player.y &&
            bubble.y < player.y + player.height;
          if (hit) score += bubble.red ? 10 : 1;
          return !hit;
        });
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (gameOver) {
          ctx.fillStyle = "red";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        } else {
          ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
        }

        ctx.drawImage(player.image, player.x, player.y, player.width, player.height);

        bubbles.forEach((bubble) => {
          const size = bubble.radius * 2;
          ctx.save();
          ctx.globalAlpha = bubble.opacity;
          const img = bubble.red ? redBubbleImage : bubbleImage;
          ctx.drawImage(img, bubble.x - bubble.radius, bubble.y - bubble.radius, size, size);
          ctx.restore();
        });

        ctx.font = "bold 20px Arial";
        ctx.fillStyle = "#aee800";
        if (!gameOver) {
          ctx.fillText("Score: " + score, canvas.width - 120, 30);
        }

        // Draw lives left
        for (let i = 0; i < lives; i++) {
          ctx.drawImage(whaleImg, 10 + i * 40, 40, 35, 35); // made bigger
        }

        if (gameOver) {
          ctx.font = "bold 30px Arial";
          ctx.fillStyle = "black";
          ctx.textAlign = "center";
          ctx.fillText("Game Over!", canvas.width / 2, canvas.height * 0.2);
          ctx.fillText("Score: " + score, canvas.width / 2, canvas.height * 0.4);
          ctx.fillText("Expansion pack: JUN25", canvas.width / 2, canvas.height * 0.5);
        }
      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      let keys = {};
      document.addEventListener("keydown", (e) => (keys[e.key] = true));
      document.addEventListener("keyup", (e) => (keys[e.key] = false));

      let isTouching = false;
      canvas.addEventListener("touchstart", function (e) {
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const touchX = touch.clientX - rect.left;
        if (touchX >= player.x && touchX <= player.x + player.width) {
          isTouching = true;
        }
      });

      canvas.addEventListener("touchmove", function (e) {
        if (isTouching) {
          const touch = e.touches[0];
          const rect = canvas.getBoundingClientRect();
          const touchX = touch.clientX - rect.left;
          player.x = touchX - player.width / 2;
          if (player.x < 0) player.x = 0;
          if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
        }
        e.preventDefault();
      }, { passive: false });

      canvas.addEventListener("touchend", function () {
        isTouching = false;
      });

      function movePlayer() {
        if (!gameOver) {
          if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
          if (keys["ArrowRight"] && player.x + player.width < canvas.width) player.x += player.speed;
        }
        requestAnimationFrame(movePlayer);
      }

      function restartGame() {
        bubbles = [];
        score = 0;
        lives = 3;
        gameOver = false;
        restartBtn.style.display = "none";
        downloadBtn.style.display = "none";
        bubbleInterval = 2000;
        lastBubbleTime = Date.now();
        lastDifficultyIncrease = Date.now();
      }

      gameLoop();
      movePlayer();
    </script>
  </body>
</html>
